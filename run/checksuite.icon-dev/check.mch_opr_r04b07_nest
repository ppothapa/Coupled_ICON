#!/bin/ksh
#--------------------------------------------------------------------------------
#
# _bb_table_Description_  MCH LAM experiment
# _bb_table_Model_        non-hydrostatic atmosphere with NWP physics

#--------------------------------------------------------------------------------
#
# 1. Define the experiment and the files to be checked
#
# EXPERIMENT is the name of the experiment, that defines the experiment descriptor
# file run/exp.<EXPNAME>. EXPNAME is used also for:
# - the output directory name: experiments/<EXPNAME>
# - the output  file names: <EXPNAME>_<TYPE>_<DATE>.nc
# - the restart file names: 
#
export EXPERIMENT='mch_opr_r04b07_nest'

# TYPES is a list of names identifying the files <EXPNAME>_<TYPE>_<DATE>.nc
# to be checked.
#
export TYPES='atm_3d_DOM01_pl atm_3d_DOM02_pl atm_3d_DOM01_hl atm_3d_DOM02_hl'

# DATES is a list of dates identifying the files <EXPNAME>_<TYPE>_<DATE>.nc
# to be checked.
#
export DATES='20201210T060140Z 20201210T060150Z 20201210T060200Z'

# RESTART_DATE defines the date and time from which restarts should be performed.
# 
export RESTART_DATE='20201210T060100Z'

# REFERENCE model directory and reference experiment for update test
# (abs. path or relative paths w.r.t. <model dir>/run, e.g. .../icon-dev/run)
#
export OVERWRITE=no
#
if [ -d /users/icontest ]
then
    poolFolder_prefix="/users/icontest"
else
    poolFolder_prefix=""
fi

#--------------------------------------------------------------------------------
# 
# 2. Define the checksuite mode
#
export MD='rt'

#--------------------------------------------------------------------------------
# 
# 3. Launch the checksuite from run/

reference_dir=$(cat $basedir/run/tolerance_reference)
export REFERENCE=$icon_data_rootFolder/buildbot_data/ref/${reference_dir}

rundir=`pwd`
cd checksuite.icon-dev

# load python packages
case $HOST in
    *daint*)
        export MD='rt'
esac

./icon-dev.checksuite
STATUS=$?

check_final_status $STATUS "$EXPERIMENT"


#--------------------------------------------------------------------------------
exit


